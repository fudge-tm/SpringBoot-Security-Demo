<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        body {
            margin: 0px;
            padding: 0px;
        }

        #app {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .el-table .warning-row {
            background: oldlace;
        }

        .el-table .success-row {
            background: #f0f9eb;
        }

        /*侧边导航css*/
        /*.el-menu-vertical-demo:not(.el-menu--collapse) {*/
        /*    width: 200px;*/
        /*    min-height: 400px;*/
        /*}*/

        .el-header {
            background-color: #B3C0D1;
            color: #333;
            line-height: 60px;
        }

        /*.el-main {*/
        /*    overflow: inherit;*/
        /*}*/

        .el-header h3 {
            display: inline-block;
            margin: 0 0 0 0px;
        }

        .el-header .el-button {
            margin-left: 50px;
        }

        .el-aside {
            color: #333;
            /*height: 100vh;*/

        }
    </style>

</head>
<body>
<!--<div class="topshow"></div>-->

<!--<button id="loginout">用户注销</button>-->
<div id="app">
    <el-container style="height: 100vh; border: 1px solid #eee">
        <el-aside width="200px" style="background-color: rgb(238, 241, 246)">
            <el-menu :default-openeds="['1', '3']">
                <el-submenu index="1">
                    <template slot="title"><i class="el-icon-message"></i>员工信息导航</template>
                    <el-menu-item-group>
                        <template slot="title">员工管理</template>
                        <el-menu-item index="1-1">员工基本信息管理</el-menu-item>
                        <el-menu-item index="1-2">员工工资管理</el-menu-item>
                        <el-menu-item index="1-3">员工职位管理</el-menu-item>
                    </el-menu-item-group>
                </el-submenu>

            </el-menu>
        </el-aside>

        <el-container>
            <el-header style="text-align: right; font-size: 12px">

                <h3 align="center">员工信息管理系统</h3>
                <el-button type="danger" plain @click="loginout">用户注销</el-button>
                <!--                <span>王小虎</span>-->
            </el-header>

            <el-main>
                <!--搜索表单-->
                <el-form :inline="true" :model="employee" class="demo-form-inline">
                    <el-form-item label="员工id">
                        <el-input v-model="employee.eid" placeholder="员工id"></el-input>
                    </el-form-item>

                    <el-form-item label="员工姓名">
                        <el-input v-model="employee.ename" placeholder="员工姓名"></el-input>
                    </el-form-item>

                    <el-form-item>
                        <el-button type="primary" @click="onSubmit">查询</el-button>
                    </el-form-item>
                </el-form>

                <!--按钮-->

                <el-row>

                    <el-button type="danger" plain @click="deleteByIds">批量删除</el-button>
                    <el-button type="primary" plain @click="dialogVisible = true">新增</el-button>

                </el-row>
                <!--添加数据对话框表单-->
                <el-dialog
                        title="编辑员工信息"
                        :visible.sync="dialogVisible"
                        width="30%"
                >

                    <el-form ref="form" :model="employee" label-width="80px">
                        <el-form-item label="员工id">
                            <el-input v-model="employee.eid"></el-input>
                        </el-form-item>

                        <el-form-item label="员工姓名">
                            <el-input v-model="employee.ename"></el-input>
                        </el-form-item>

                        <el-form-item label="员工密码">
                            <el-input v-model="employee.password"></el-input>
                        </el-form-item>

                        <el-form-item label="员工权限">
                            <el-input v-model="employee.superuser"></el-input>
                        </el-form-item>


                        <el-form-item label="员工标志">
                            <el-switch v-model="employee.flag"
                                       active-value="1"
                                       inactive-value="0"
                            ></el-switch>
                        </el-form-item>


                        <el-form-item>
                            <el-button type="primary" @click="addEmployee">提交</el-button>
                            <el-button @click="dialogVisible = false">取消</el-button>
                        </el-form-item>
                    </el-form>

                </el-dialog>


                <!--表格-->
                <template>
                    <el-table
                            :data="tableData"
                            style="width: 100%"
                            :row-class-name="tableRowClassName"
                            @selection-change="handleSelectionChange"
                    >
                        <el-table-column
                                type="selection"
                                width="55">
                        </el-table-column>
                        <el-table-column
                                type="index"
                                width="50">
                        </el-table-column>

                        <el-table-column
                                prop="eid"
                                label="员工id"
                                align="center"
                        >
                        </el-table-column>
                        <el-table-column
                                prop="ename"
                                label="员工姓名"
                                align="center"
                        >
                        </el-table-column>
                        <el-table-column
                                prop="password"
                                align="center"
                                label="员工密码">
                        </el-table-column>
                        <el-table-column
                                prop="superuser"
                                align="center"
                                label="员工权限">
                        </el-table-column>
                        <el-table-column
                                prop="flag"
                                align="center"
                                label="员工标志位">
                        </el-table-column>

                        <el-table-column
                                align="center"
                                label="操作">

                            <el-row>
                                <el-button type="primary" @click="updateEmployee">修改</el-button>
                                <el-button type="danger" @click="deleteEmployee">删除</el-button>
                            </el-row>

                        </el-table-column>

                    </el-table>
                </template>

                <!--分页工具条-->
                <el-pagination
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="currentPage"
                        :page-sizes="[5, 10, 15, 20]"
                        :page-size="5"
                        layout="total, sizes, prev, pager, next, jumper"
                        :total="totalCount">
                </el-pagination>

            </el-main>
        </el-container>
    </el-container>


</div>


<script src="../js/vue.js"></script>
<script src="../element-ui/lib/index.js"></script>
<link rel="stylesheet" href="../element-ui/lib/theme-chalk/index.css">
<link rel="stylesheet" href="../css/index.css">


<script src="../js/axios-0.18.0.js"></script>

<script>
    // import {axios} from "./js/axios-0.18.0";

    new Vue({
        el: "#app",
        // 侧边导航
        mounted() {
            this.selectAll();
            // var _this=this;
            // axios({
            //     method:"get",
            //     url:"http://localhost:8080/brand-case/selectAllServlet"
            // }).then(function (resp) {
            //     _this.tableData=resp.data;
            // })
        },

        methods: {
            // 侧边导航开关


            // 查询分页数据
            selectAll() {
                axios({
                    method: "post",
                    url: "http://localhost:8080/employee/selectPageAndCondition?currentPage=" + this.currentPage + "&pageSize=" + this.pageSize,
                    data: this.employee
                }).then(resp => {
                    // 设置表格数据
                    this.tableData = resp.data.rows;
                    // 总记录数
                    this.totalCount = resp.data.totalCount;
                })
            },
            tableRowClassName({row, rowIndex}) {
                if (rowIndex === 1) {
                    return 'warning-row';
                } else if (rowIndex === 3) {
                    return 'success-row';
                }
                return '';
            },

            // 复选框选中后执行的方法
            handleSelectionChange(val) {
                this.multipleSelection = val;

                console.log(this.multipleSelection)
            },
            // 查询方法
            onSubmit() {
                // console.log(this.brand);
                this.selectAll();
            },
            // 添加数据
            addEmployee() {
                // console.log(this.brand);
                // 发送Ajax请求，添加数据

                var _this = this;
                // console.log(_this.currentPage + "***")
                // console.log(_this.pageSize + "***")
                axios({
                    method: "post",
                    url: "http://localhost:8080/employee/add",
                    data: _this.employee
                }).then(function (resp) {
                    if (resp.data == "success") {
                        // console.log(_this.currentPage)
                        // console.log(_this.pageSize + "***")
                        // 关闭窗口
                        _this.dialogVisible = false;
                        // 重新查询数据
                        _this.selectAll();
                        // 弹出消息提示
                        _this.$message({
                            message: '添加成功',
                            type: 'success'
                        });

                    }
                })
            },

            //分页
            handleSizeChange(val) {
                // console.log(`每页 ${val} 条`);
                //  重新设置每页显示的条数
                this.pageSize = val;
                this.selectAll();
            },
            handleCurrentChange(val) {
                // console.log(`当前页: ${val}`);
                this.currentPage = val;
                this.selectAll();
            },

            deleteByIds() {

                // 弹出确认提示框
                this.$confirm('此操作将删除该数据, 是否继续?', '提示', {
                    confirmButtonText: '确定',
                    cancelButtonText: '取消',
                    type: 'warning'
                }).then(() => {
                    // 用户点击确认按钮

                    // 1.创建id数组
                    for (let i = 0; i < this.multipleSelection.length; i++) {
                        let selectionElement = this.multipleSelection[i];
                        this.selectedIds[i] = selectionElement.id;
                    }

                    // 2.发送Ajax请求
                    var _this = this;
                    axios({
                        method: "post",
                        url: "http://localhost:8080/employee/deleteByIds",
                        data: _this.selectedIds
                    }).then(function (resp) {
                        if (resp.data == "success") {
                            // 删除成功
                            // 重新查询数据
                            _this.selectAll();
                            // 弹出消息提示
                            _this.$message({
                                message: '删除成功',
                                type: 'success'
                            });

                        }
                    })
                }).catch(() => {
                    // 用户点击取消按钮
                    this.$message({
                        type: 'info',
                        message: '已取消删除'
                    });
                });


            },

            deleteEmployee() {
                //
                // // 弹出确认提示框
                // this.$confirm('此操作将删除该数据, 是否继续?', '提示', {
                //     confirmButtonText: '确定',
                //     cancelButtonText: '取消',
                //     type: 'warning'
                // }).then(() => {
                //     // 用户点击确认按钮
                //
                //     // 1.创建id数组
                //     for (let i = 0; i < this.multipleSelection.length; i++) {
                //         let selectionElement = this.multipleSelection[i];
                //         this.selectedIds[i] = selectionElement.id;
                //     }
                //
                //     // 2.发送Ajax请求
                //     var _this = this;
                //     axios({
                //         method: "post",
                //         url: "http://localhost:8080/employee/deleteByIds",
                //         data: _this.selectedIds
                //     }).then(function (resp) {
                //         if (resp.data == "success") {
                //             // 删除成功
                //             // 重新查询数据
                //             _this.selectAll();
                //             // 弹出消息提示
                //             _this.$message({
                //                 message: '删除成功',
                //                 type: 'success'
                //             });
                //
                //         }
                //     })
                // }).catch(() => {
                //     // 用户点击取消按钮
                //     this.$message({
                //         type: 'info',
                //         message: '已取消删除'
                //     });
                // });


            },

            loginout() {

            }

        },
        data() {
            return {
                // tableData: Array(20).fill(item),
                // 侧边导航
                // isCollapse: true,
                // 每页显示的条数
                pageSize: 5,
                // 总记录数
                totalCount: 100,
                // 当前页码
                currentPage: 1,
                // 添加数据对话框是否展示的标记
                dialogVisible: false,
                //被选中的id数组
                selectedIds: [],
                selectId: "",

                // 员工模型数据
                employee: {
                    eid: "",
                    ename: "",
                    password: "",
                    superuser: "",
                    flag: ""
                },
                // 复选框选中数据集合
                multipleSelection: [],
                // 表格数据
                tableData: {
                    eid: "",
                    ename: "",
                    password: "",
                    superuser: "",
                    flag: "",
                    // Array(20).fill(item)
                }

            }
        }
    })

</script>

</body>
</html>
